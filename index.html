<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Selection on Touch</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            line-height: 1.6;
            font-size: 18px;
        }
        
        #content {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        span {
            margin-right: 5px;
        }
        
        .highlight {
            background-color: yellow;
        }
        
        #selected-word-display {
            margin-top: 20px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
            min-height: 20px;
        }
    </style>
</head>
<body>
    <h1>Touch to Select Words</h1>
    <p>Tap on any word in the text below to select it:</p>
    
    <div id="content">
        <span>This is some English text.</span>
        <span>Esto es texto en español.</span>
        <span>这是中文文本。</span>
        <span>これは日本語のテキストです。</span>
        <span>هذا نص باللغة العربية.</span>
    </div>
    
    <div id="selected-word-display">
        <strong>Selected word will appear here</strong>
    </div>

    <script>
        // This script enables selecting words on touch/tap in mobile browsers
        document.addEventListener('DOMContentLoaded', function() {
            // Get the container div with all the spans
            const container = document.getElementById('content');
            const wordDisplay = document.getElementById('selected-word-display');
            
            // Add touch event listener to the container (event delegation)
            container.addEventListener('touchend', function(event) {
                // Prevent the default behavior (like zooming or scrolling)
                event.preventDefault();
                
                // Get the touch coordinates
                const touch = event.changedTouches[0];
                
                // Get the element at touch position
                const element = document.elementFromPoint(touch.clientX, touch.clientY);
                
                // Check if we touched a span or its child text node
                const span = element.closest('span');
                if (!span || !span.textContent.trim()) return;
                
                // Create a range to work with the selection
                const range = document.createRange();
                const selection = window.getSelection();
                
                // Get text node (either direct or as child)
                let textNode;
                if (element.nodeType === Node.TEXT_NODE) {
                    textNode = element;
                } else if (element.firstChild && element.firstChild.nodeType === Node.TEXT_NODE) {
                    textNode = element.firstChild;
                } else {
                    return; // No text node found
                }
                
                // Find the word boundaries
                const text = textNode.textContent;
                const touchPoint = findOffsetAtPoint(textNode, touch.clientX, touch.clientY);
                if (touchPoint === -1) return;
                
                // Find word boundaries (works for most languages)
                const startPos = findWordStart(text, touchPoint);
                const endPos = findWordEnd(text, touchPoint);
                
                // Create and apply the selection
                try {
                    range.setStart(textNode, startPos);
                    range.setEnd(textNode, endPos);
                    
                    selection.removeAllRanges();
                    selection.addRange(range);
                    
                    // Display the selected word
                    const selectedWord = text.substring(startPos, endPos);
                    wordDisplay.innerHTML = `<strong>Selected:</strong> "${selectedWord}"`;
                } catch (e) {
                    console.error('Selection error:', e);
                }
            });
            
            // Helper function to find the offset in a text node at a specific coordinate
            function findOffsetAtPoint(textNode, x, y) {
                const range = document.createRange();
                const textContent = textNode.textContent;
                
                // Binary search to find the character at position
                let start = 0;
                let end = textContent.length;
                
                while (start <= end) {
                    const mid = Math.floor((start + end) / 2);
                    
                    range.setStart(textNode, 0);
                    range.setEnd(textNode, mid);
                    
                    const rect = range.getBoundingClientRect();
                    
                    if (x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom) {
                        // Refine the search
                        if (mid === textContent.length || (x - rect.right) < (rect.right - rect.left) / textContent.length) {
                            return mid;
                        } else {
                            start = mid + 1;
                        }
                    } else if (x < rect.left) {
                        end = mid - 1;
                    } else {
                        start = mid + 1;
                    }
                }
                
                return -1; // Not found
            }
            
            // Find the start of a word (works for most languages)
            function findWordStart(text, position) {
                if (position <= 0) return 0;
                
                // Support for different languages
                // This basic implementation works for space-separated languages
                let pos = position;
                
                // Move backward until we find a word boundary
                while (pos > 0 && !/\s/.test(text.charAt(pos - 1))) {
                    pos--;
                }
                
                return pos;
            }
            
            // Find the end of a word (works for most languages)
            function findWordEnd(text, position) {
                if (position >= text.length) return text.length;
                
                // Support for different languages
                // This basic implementation works for space-separated languages
                let pos = position;
                
                // Move forward until we find a word boundary
                while (pos < text.length && !/\s/.test(text.charAt(pos))) {
                    pos++;
                }
                
                return pos;
            }
        });
    </script>
</body>
</html>
