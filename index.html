function handleWordSelect(e) {
  setTimeout(() => {
    const selection = window.getSelection();
    if (!selection.rangeCount) return;

    const range = selection.getRangeAt(0);
    const node = selection.anchorNode;

    if (!node || node.nodeType !== Node.TEXT_NODE) return;

    const text = node.textContent;
    const offset = selection.anchorOffset;

    const segmenter = new Intl.Segmenter('und', { granularity: 'word' });
    const segments = [...segmenter.segment(text)];

    for (const segment of segments) {
      const start = segment.index;
      const end = start + segment.segment.length;

      if (offset >= start && offset <= end) {
        const wordRange = document.createRange();
        wordRange.setStart(node, start);
        wordRange.setEnd(node, end);

        selection.removeAllRanges();
        selection.addRange(wordRange);

        document.getElementById('selected-word').textContent = segment.segment;
        break;
      }
    }
  }, 0); // Delay so it runs after native selection
}

document.getElementById('text-container').addEventListener('click', handleWordSelect);
document.getElementById('text-container').addEventListener('touchend', handleWordSelect, false);
